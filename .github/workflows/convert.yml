      - name: Convert each channel to M3U8
        run: |
          set +e  # allow errors without stopping
          mkdir -p output
          USER_AGENT="plaYtv/7.1.3 (Linux;Android 13) ygx/69.1 ExoPlayerLib/824.0"
          MASTER_FILE="output/jaupl.m3u"

          echo "#EXTM3U" > "$MASTER_FILE"

          while IFS= read -r line; do
            if [[ $line == http* ]]; then
              URL=$(echo "$line" | cut -d'|' -f1)
              COOKIE=$(echo "$line" | grep -oP 'cookie=\K[^|]+')
              KEY_PAIR=$(echo "$line" | grep -oP 'key=\K[^|]+')
              CHANNEL=$(basename "$(dirname "$URL")")

              echo "üé¨ Processing: $CHANNEL"
              OUTPUT_FILE="output/${CHANNEL}.m3u8"

              ffmpeg -headers "user-agent: $USER_AGENT" \
                     -headers "cookie: $COOKIE" \
                     -decryption_key $(echo $KEY_PAIR | cut -d':' -f2) \
                     -i "$URL" \
                     -c copy -f hls "$OUTPUT_FILE"

              if [ $? -eq 0 ]; then
                echo "#EXTINF:-1,${CHANNEL}" >> "$MASTER_FILE"
                echo "https://<YOUR-VERCEL-DOMAIN>/output/${CHANNEL}.m3u8" >> "$MASTER_FILE"
                echo "‚úÖ $CHANNEL converted successfully"
              else
                echo "‚ö†Ô∏è Skipped $CHANNEL (conversion error)"
              fi
            fi
          done < playlist/input.m3u

          echo "‚úÖ Created jaupl.m3u master playlist"
